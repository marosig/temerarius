<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temerarius - Real-Time Chat</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <style>
        /* Temerarius Chat Application Styles */

:root {
  --primary-color: #3b82f6;
  --primary-dark: #2563eb;
  --secondary-color: #64748b;
  --success-color: #10b981;
  --danger-color: #ef4444;
  --warning-color: #f59e0b;
  --dark-bg: #0f172a;
  --dark-surface: #1e293b;
  --dark-surface-hover: #334155;
  --light-text: #f1f5f9;
  --muted-text: #94a3b8;
  --border-color: #334155;
  --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
  --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
  --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
  --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: var(--dark-bg);
  color: var(--light-text);
  overflow: hidden;
  height: 100vh;
}

.hidden {
  display: none !important;
}

/* Login Screen Styles */
.login-screen {
  position: relative;
  height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  overflow: hidden;
}

.login-bg {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

.floating-bubble {
  position: absolute;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 50%;
  animation: float 6s ease-in-out infinite;
}

.floating-bubble:nth-child(1) {
  width: 80px;
  height: 80px;
  top: 20%;
  left: 20%;
  animation-delay: 0s;
}

.floating-bubble:nth-child(2) {
  width: 60px;
  height: 60px;
  top: 60%;
  right: 20%;
  animation-delay: 2s;
}

.floating-bubble:nth-child(3) {
  width: 100px;
  height: 100px;
  bottom: 20%;
  left: 10%;
  animation-delay: 4s;
}

.floating-bubble:nth-child(4) {
  width: 40px;
  height: 40px;
  top: 10%;
  right: 10%;
  animation-delay: 1s;
}

@keyframes float {
  0%, 100% { transform: translateY(0px) rotate(0deg); }
  50% { transform: translateY(-20px) rotate(180deg); }
}

.login-container {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(20px);
  padding: 3rem;
  border-radius: 20px;
  box-shadow: var(--shadow-xl);
  text-align: center;
  width: 100%;
  max-width: 400px;
  z-index: 10;
}

.logo {
  margin-bottom: 2rem;
}

.logo i {
  font-size: 3rem;
  color: var(--primary-color);
  margin-bottom: 1rem;
}

.logo h1 {
  font-size: 2.5rem;
  font-weight: 700;
  color: #1e293b;
  margin-bottom: 0.5rem;
}

.logo p {
  color: var(--secondary-color);
  font-size: 1.1rem;
}

.login-form {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.input-group {
  position: relative;
  display: flex;
  align-items: center;
}

.input-group i {
  position: absolute;
  left: 1rem;
  color: var(--secondary-color);
  z-index: 2;
}

.input-group input,
.input-group select {
  width: 100%;
  padding: 1rem 1rem 1rem 3rem;
  border: 2px solid #e2e8f0;
  border-radius: 12px;
  font-size: 1rem;
  transition: all 0.3s ease;
  background: #fff;
}

.input-group input:focus,
.input-group select:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.login-btn {
  padding: 1rem 2rem;
  background: var(--primary-color);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 1.1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
}

.login-btn:hover {
  background: var(--primary-dark);
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

/* Chat Interface Styles */
.chat-interface {
  height: 100vh;
  display: flex;
  flex-direction: column;
  background: var(--dark-bg);
}

/* Header */
.chat-header {
  background: var(--dark-surface);
  padding: 1rem 1.5rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 1px solid var(--border-color);
  box-shadow: var(--shadow-sm);
}

.header-left {
  display: flex;
  align-items: center;
}

.logo-small {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-weight: 700;
  font-size: 1.2rem;
  color: var(--primary-color);
}

.header-center {
  text-align: center;
}

.header-center h2 {
  font-size: 1.3rem;
  margin-bottom: 0.25rem;
}

.online-status {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: var(--muted-text);
  font-size: 0.9rem;
}

.status-dot {
  width: 8px;
  height: 8px;
  background: var(--success-color);
  border-radius: 50%;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.header-right {
  display: flex;
  gap: 0.5rem;
}

.icon-btn {
  padding: 0.5rem;
  background: transparent;
  border: none;
  color: var(--muted-text);
  cursor: pointer;
  border-radius: 8px;
  transition: all 0.3s ease;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.icon-btn:hover {
  background: var(--dark-surface-hover);
  color: var(--light-text);
}

/* Main Chat Area */
.chat-main {
  flex: 1;
  display: flex;
  overflow: hidden;
}

/* Sidebar */
.sidebar {
  width: 280px;
  background: var(--dark-surface);
  border-right: 1px solid var(--border-color);
  padding: 1rem;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.sidebar-section h3 {
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--muted-text);
  margin-bottom: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.users-list {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.user-item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.5rem;
  border-radius: 8px;
  transition: all 0.3s ease;
  cursor: pointer;
}

.user-item:hover {
  background: var(--dark-surface-hover);
}

.user-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  font-size: 0.8rem;
  color: white;
}

.user-name {
  font-weight: 500;
}

.user-status {
  font-size: 0.8rem;
  color: var(--muted-text);
  margin-left: auto;
}

.activity-feed {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.activity-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.85rem;
  color: var(--muted-text);
}

.text-green { color: var(--success-color); }
.text-blue { color: var(--primary-color); }
.text-red { color: var(--danger-color); }

/* Chat Content */
.chat-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  height: 100%;
}

.messages-container {
  flex: 1;
  padding: 1rem;
  overflow-y: auto;
  scroll-behavior: smooth;
}

.welcome-message {
  text-align: center;
  padding: 3rem 1rem;
  color: var(--muted-text);
}

.welcome-message i {
  font-size: 3rem;
  color: var(--primary-color);
  margin-bottom: 1rem;
}

.welcome-message h3 {
  font-size: 1.5rem;
  margin-bottom: 0.5rem;
  color: var(--light-text);
}

/* Messages */
.message {
  display: flex;
  gap: 0.75rem;
  margin-bottom: 1rem;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.message-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  font-size: 0.9rem;
  color: white;
  flex-shrink: 0;
}

.message-content {
  flex: 1;
}

.message-header {
  display: flex;
  align-items: baseline;
  gap: 0.5rem;
  margin-bottom: 0.25rem;
}

.message-author {
  font-weight: 600;
  font-size: 0.9rem;
}

.message-time {
  font-size: 0.8rem;
  color: var(--muted-text);
}

.message-text {
  line-height: 1.5;
  word-wrap: break-word;
}

.message.own {
  flex-direction: row-reverse;
}

.message.own .message-content {
  text-align: right;
}

.message.own .message-header {
  flex-direction: row-reverse;
}

.system-message {
  text-align: center;
  color: var(--muted-text);
  font-size: 0.85rem;
  margin: 0.5rem 0;
  padding: 0.5rem;
  background: var(--dark-surface);
  border-radius: 8px;
  border-left: 3px solid var(--primary-color);
}

/* Message Input */
.message-input-container {
  border-top: 1px solid var(--border-color);
  background: var(--dark-surface);
  padding: 1rem;
}

.message-form {
  display: flex;
  align-items: center;
}

.input-wrapper {
  display: flex;
  align-items: center;
  background: var(--dark-bg);
  border: 1px solid var(--border-color);
  border-radius: 24px;
  padding: 0.5rem;
  width: 100%;
  transition: border-color 0.3s ease;
}

.input-wrapper:focus-within {
  border-color: var(--primary-color);
}

.emoji-btn {
  background: none;
  border: none;
  color: var(--muted-text);
  cursor: pointer;
  padding: 0.5rem;
  border-radius: 50%;
  transition: all 0.3s ease;
}

.emoji-btn:hover {
  color: var(--light-text);
  background: var(--dark-surface-hover);
}

#messageInput {
  flex: 1;
  background: none;
  border: none;
  color: var(--light-text);
  padding: 0.5rem;
  font-size: 1rem;
  outline: none;
}

#messageInput::placeholder {
  color: var(--muted-text);
}

.send-btn {
  background: var(--primary-color);
  border: none;
  color: white;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.send-btn:hover {
  background: var(--primary-dark);
  transform: scale(1.05);
}

.typing-indicator {
  margin-top: 0.5rem;
  font-size: 0.85rem;
  color: var(--muted-text);
  min-height: 1.2rem;
}

/* Modal Styles */
.modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.modal-content {
  background: var(--dark-surface);
  border-radius: 16px;
  width: 90%;
  max-width: 500px;
  max-height: 90vh;
  overflow: hidden;
  box-shadow: var(--shadow-xl);
}

.modal-header {
  padding: 1.5rem;
  border-bottom: 1px solid var(--border-color);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.modal-header h3 {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-weight: 600;
}

.close-btn {
  background: none;
  border: none;
  color: var(--muted-text);
  font-size: 1.5rem;
  cursor: pointer;
  padding: 0.5rem;
  border-radius: 8px;
  transition: all 0.3s ease;
}

.close-btn:hover {
  background: var(--dark-surface-hover);
  color: var(--light-text);
}

.modal-body {
  padding: 1.5rem;
}

.setting-group {
  margin-bottom: 1.5rem;
}

.setting-group label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 500;
  color: var(--light-text);
}

.setting-group select,
.setting-group input[type="text"] {
  width: 100%;
  padding: 0.75rem;
  background: var(--dark-bg);
  border: 1px solid var(--border-color);
  border-radius: 8px;
  color: var(--light-text);
  font-size: 1rem;
}

.setting-group input[type="checkbox"] {
  transform: scale(1.2);
  margin-left: 0.5rem;
}

.clear-btn {
  background: var(--danger-color);
  color: white;
  border: none;
  padding: 0.75rem 1.5rem;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 500;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.clear-btn:hover {
  background: #dc2626;
  transform: translateY(-1px);
}

/* Responsive Design */
@media (max-width: 768px) {
  .sidebar {
    display: none;
  }
  
  .login-container {
    padding: 2rem;
    margin: 1rem;
  }
  
  .chat-header {
    padding: 1rem;
  }
  
  .header-center h2 {
    font-size: 1.1rem;
  }
  
  .modal-content {
    margin: 1rem;
    width: calc(100% - 2rem);
  }
}

/* Scrollbar Styling */
::-webkit-scrollbar {
  width: 6px;
}

::-webkit-scrollbar-track {
  background: var(--dark-surface);
}

::-webkit-scrollbar-thumb {
  background: var(--border-color);
  border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--muted-text);
}
    </style>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div class="logo">
                <i class="fas fa-comments"></i>
                <h1>Temerarius</h1>
                <p>Connect. Chat. Conquer.</p>
            </div>
            <form id="loginForm" class="login-form">
                <div class="input-group">
                    <i class="fas fa-user"></i>
                    <input type="text" id="usernameInput" placeholder="Enter your username" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-palette"></i>
                    <select id="colorSelect">
                        <option value="#3b82f6">Blue</option>
                        <option value="#ef4444">Red</option>
                        <option value="#10b981">Green</option>
                        <option value="#f59e0b">Orange</option>
                        <option value="#8b5cf6">Purple</option>
                        <option value="#ec4899">Pink</option>
                    </select>
                </div>
                <button type="submit" class="login-btn">
                    <i class="fas fa-rocket"></i>
                    Join Chat
                </button>
            </form>
        </div>
        <div class="login-bg">
            <div class="floating-bubble"></div>
            <div class="floating-bubble"></div>
            <div class="floating-bubble"></div>
            <div class="floating-bubble"></div>
        </div>
    </div>

    <!-- Chat Interface -->
    <div id="chatInterface" class="chat-interface hidden">
        <!-- Header -->
        <header class="chat-header">
            <div class="header-left">
                <div class="logo-small">
                    <i class="fas fa-comments"></i>
                    <span>Temerarius</span>
                </div>
            </div>
            <div class="header-center">
                <h2 id="chatTitle">Global Chat</h2>
                <div class="online-status">
                    <span class="status-dot"></span>
                    <span id="onlineCount">0 online</span>
                </div>
            </div>
            <div class="header-right">
                <button id="settingsBtn" class="icon-btn">
                    <i class="fas fa-cog"></i>
                </button>
                <button id="logoutBtn" class="icon-btn">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </header>

        <!-- Main Chat Area -->
        <main class="chat-main">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-section">
                    <h3><i class="fas fa-users"></i> Online Users</h3>
                    <div id="usersList" class="users-list"></div>
                </div>
                <div class="sidebar-section">
                    <h3><i class="fas fa-history"></i> Recent Activity</h3>
                    <div class="activity-feed">
                        <div class="activity-item">
                            <i class="fas fa-circle text-green"></i>
                            <span>Chat started</span>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Chat Messages Area -->
            <div class="chat-content">
                <div id="messagesContainer" class="messages-container">
                    <div class="welcome-message">
                        <i class="fas fa-rocket"></i>
                        <h3>Welcome to Temerarius!</h3>
                        <p>Start chatting with people from around the world</p>
                    </div>
                </div>

                <!-- Message Input -->
                <div class="message-input-container">
                    <form id="messageForm" class="message-form">
                        <div class="input-wrapper">
                            <button type="button" id="emojiBtn" class="emoji-btn">
                                <i class="fas fa-smile"></i>
                            </button>
                            <input type="text" id="messageInput" placeholder="Type your message..." autocomplete="off">
                            <button type="submit" class="send-btn">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </form>
                    <div class="typing-indicator" id="typingIndicator"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-cog"></i> Settings</h3>
                <button id="closeSettings" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="setting-group">
                    <label>Change Color:</label>
                    <select id="newColorSelect">
                        <option value="#3b82f6">Blue</option>
                        <option value="#ef4444">Red</option>
                        <option value="#10b981">Green</option>
                        <option value="#f59e0b">Orange</option>
                        <option value="#8b5cf6">Purple</option>
                        <option value="#ec4899">Pink</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label>Sound Notifications:</label>
                    <input type="checkbox" id="soundToggle" checked>
                </div>
                <div class="setting-group">
                    <button id="clearChatBtn" class="clear-btn">
                        <i class="fas fa-trash"></i> Clear Chat History
                    </button>
                </div>
            </div>
        </div>
    </div>

   <script>
    // Temerarius Chat Application - Core Chat Functionality

class TemerariusChat {
    constructor() {
        this.currentUser = null;
        this.messages = this.loadMessages();
        this.users = new Map();
        this.typingUsers = new Set();
        this.settings = this.loadSettings();
        this.lastActivity = Date.now();
        this.activityChecker = null;
        
        // Simulate real-time by polling every 500ms
        this.messagePoller = null;
        this.userPoller = null;
        this.typingPoller = null;
        
        this.init();
    }

    init() {
        this.bindEvents();
        this.startActivityMonitoring();
        console.log('Temerarius Chat initialized');
    }

    bindEvents() {
        // Login form
        const loginForm = document.getElementById('loginForm');
        if (loginForm) {
            loginForm.addEventListener('submit', (e) => this.handleLogin(e));
        }

        // Message form
        const messageForm = document.getElementById('messageForm');
        if (messageForm) {
            messageForm.addEventListener('submit', (e) => this.sendMessage(e));
        }

        // Message input typing
        const messageInput = document.getElementById('messageInput');
        if (messageInput) {
            messageInput.addEventListener('input', () => this.handleTyping());
            messageInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    this.sendMessage(e);
                }
            });
        }

        // Logout button
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', () => this.logout());
        }

        // Window visibility change
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden && this.currentUser) {
                this.updateUserStatus('online');
            }
        });

        // Before unload
        window.addEventListener('beforeunload', () => {
            if (this.currentUser) {
                this.updateUserStatus('offline');
            }
        });
    }

    handleLogin(e) {
        e.preventDefault();
        
        const username = document.getElementById('usernameInput').value.trim();
        const color = document.getElementById('colorSelect').value;
        
        if (!username) return;

        this.currentUser = {
            id: this.generateUserId(),
            username: username,
            color: color,
            joinedAt: Date.now(),
            status: 'online',
            lastSeen: Date.now()
        };

        // Save user to storage
        this.saveUser(this.currentUser);
        
        // Add system message
        this.addSystemMessage(`${username} joined the chat`);
        
        // Switch to chat interface
        document.getElementById('loginScreen').classList.add('hidden');
        document.getElementById('chatInterface').classList.remove('hidden');
        
        // Update UI theme
        document.documentElement.style.setProperty('--primary-color', color);
        
        // Start real-time simulation
        this.startRealTimeSimulation();
        
        // Focus message input
        document.getElementById('messageInput').focus();
        
        console.log('User logged in:', this.currentUser);
    }

    sendMessage(e) {
        e.preventDefault();
        
        const input = document.getElementById('messageInput');
        const text = input.value.trim();
        
        if (!text || !this.currentUser) return;

        const message = {
            id: this.generateMessageId(),
            userId: this.currentUser.id,
            username: this.currentUser.username,
            color: this.currentUser.color,
            text: text,
            timestamp: Date.now(),
            type: 'user'
        };

        // Add message to storage
        this.messages.push(message);
        this.saveMessages();
        
        // Clear input
        input.value = '';
        
        // Stop typing indicator
        this.stopTyping();
        
        // Update activity
        this.updateActivity();
        
        console.log('Message sent:', message);
    }

    addSystemMessage(text) {
        const message = {
            id: this.generateMessageId(),
            text: text,
            timestamp: Date.now(),
            type: 'system'
        };

        this.messages.push(message);
        this.saveMessages();
        
        console.log('System message added:', message);
    }

    handleTyping() {
        if (!this.currentUser) return;
        
        // Add current user to typing
        this.typingUsers.add(this.currentUser.username);
        this.saveTypingUsers();
        
        // Clear existing timeout
        if (this.typingTimeout) {
            clearTimeout(this.typingTimeout);
        }
        
        // Set timeout to stop typing
        this.typingTimeout = setTimeout(() => {
            this.stopTyping();
        }, 2000);
    }

    stopTyping() {
        if (!this.currentUser) return;
        
        this.typingUsers.delete(this.currentUser.username);
        this.saveTypingUsers();
        
        if (this.typingTimeout) {
            clearTimeout(this.typingTimeout);
            this.typingTimeout = null;
        }
    }

    updateUserStatus(status) {
        if (!this.currentUser) return;
        
        this.currentUser.status = status;
        this.currentUser.lastSeen = Date.now();
        this.saveUser(this.currentUser);
    }

    updateActivity() {
        this.lastActivity = Date.now();
        if (this.currentUser) {
            this.updateUserStatus('online');
        }
    }

    startActivityMonitoring() {
        // Check for user activity every 30 seconds
        this.activityChecker = setInterval(() => {
            const now = Date.now();
            const timeSinceActivity = now - this.lastActivity;
            
            if (this.currentUser) {
                if (timeSinceActivity > 300000) { // 5 minutes = away
                    this.updateUserStatus('away');
                } else if (timeSinceActivity > 60000) { // 1 minute = idle
                    this.updateUserStatus('idle');
                } else {
                    this.updateUserStatus('online');
                }
            }
        }, 30000);
    }

    startRealTimeSimulation() {
        // Poll for new messages every 500ms
        this.messagePoller = setInterval(() => {
            this.checkForNewMessages();
        }, 500);
        
        // Poll for user updates every 2 seconds
        this.userPoller = setInterval(() => {
            this.updateUsersList();
        }, 2000);
        
        // Poll for typing indicators every 1 second
        this.typingPoller = setInterval(() => {
            this.updateTypingIndicator();
        }, 1000);
        
        // Initial updates
        this.checkForNewMessages();
        this.updateUsersList();
    }

    stopRealTimeSimulation() {
        if (this.messagePoller) {
            clearInterval(this.messagePoller);
            this.messagePoller = null;
        }
        if (this.userPoller) {
            clearInterval(this.userPoller);
            this.userPoller = null;
        }
        if (this.typingPoller) {
            clearInterval(this.typingPoller);
            this.typingPoller = null;
        }
    }

    checkForNewMessages() {
        const storedMessages = this.loadMessages();
        
        // Find new messages
        const lastDisplayed = this.getLastDisplayedMessageId();
        const newMessages = storedMessages.filter(msg => 
            msg.id > lastDisplayed && 
            (!this.currentUser || msg.userId !== this.currentUser.id)
        );
        
        if (newMessages.length > 0) {
            this.messages = storedMessages;
            newMessages.forEach(msg => {
                if (this.settings.soundNotifications) {
                    this.playNotificationSound();
                }
            });
        }
    }

    getLastDisplayedMessageId() {
        const messagesContainer = document.getElementById('messagesContainer');
        const messageElements = messagesContainer.querySelectorAll('.message');
        
        if (messageElements.length === 0) return 0;
        
        const lastMessage = messageElements[messageElements.length - 1];
        return parseInt(lastMessage.dataset.messageId) || 0;
    }

    updateUsersList() {
        const storedUsers = this.loadAllUsers();
        const usersList = document.getElementById('usersList');
        const onlineCount = document.getElementById('onlineCount');
        
        if (!usersList || !onlineCount) return;
        
        // Filter active users (seen in last 10 minutes)
        const now = Date.now();
        const activeUsers = storedUsers.filter(user => 
            now - user.lastSeen < 600000
        );
        
        // Sort by status and name
        activeUsers.sort((a, b) => {
            const statusOrder = { online: 0, idle: 1, away: 2, offline: 3 };
            const statusDiff = statusOrder[a.status] - statusOrder[b.status];
            return statusDiff || a.username.localeCompare(b.username);
        });
        
        // Update users list
        usersList.innerHTML = activeUsers.map(user => `
            <div class="user-item" data-user-id="${user.id}">
                <div class="user-avatar" style="background-color: ${user.color}">
                    ${user.username.charAt(0).toUpperCase()}
                </div>
                <span class="user-name">${user.username}</span>
                <span class="user-status status-${user.status}">
                    ${user.status}
                </span>
            </div>
        `).join('');
        
        // Update online count
        const onlineUsers = activeUsers.filter(u => u.status === 'online');
        onlineCount.textContent = `${onlineUsers.length} online`;
        
        this.users = new Map(activeUsers.map(user => [user.id, user]));
    }

    updateTypingIndicator() {
        const indicator = document.getElementById('typingIndicator');
        if (!indicator) return;
        
        const typingUsers = this.loadTypingUsers();
        const otherTypingUsers = Array.from(typingUsers).filter(username => 
            !this.currentUser || username !== this.currentUser.username
        );
        
        if (otherTypingUsers.length === 0) {
            indicator.textContent = '';
        } else if (otherTypingUsers.length === 1) {
            indicator.textContent = `${otherTypingUsers[0]} is typing...`;
        } else if (otherTypingUsers.length === 2) {
            indicator.textContent = `${otherTypingUsers.join(' and ')} are typing...`;
        } else {
            indicator.textContent = `${otherTypingUsers.slice(0, -1).join(', ')} and ${otherTypingUsers[otherTypingUsers.length - 1]} are typing...`;
        }
    }

    playNotificationSound() {
        if (!this.settings.soundNotifications) return;
        
        // Create a simple notification sound using Web Audio API
        try {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
            oscillator.frequency.setValueAtTime(600, audioContext.currentTime + 0.1);
            
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.2);
        } catch (e) {
            console.log('Could not play notification sound:', e);
        }
    }

    logout() {
        if (this.currentUser) {
            // Mark user as explicitly logged out
            this.currentUser.status = 'logged out';
            this.currentUser.lastSeen = Date.now();
            this.saveUser(this.currentUser);
            
            this.addSystemMessage(`${this.currentUser.username} logged out`);
        }
        
        this.stopRealTimeSimulation();
        this.stopTyping();
        
        if (this.activityChecker) {
            clearInterval(this.activityChecker);
        }
        
        this.currentUser = null;
        
        // Switch back to login screen
        document.getElementById('chatInterface').classList.add('hidden');
        document.getElementById('loginScreen').classList.remove('hidden');
        
        // Clear login form
        document.getElementById('usernameInput').value = '';
        
        console.log('User logged out');
    }

    // Storage methods
    saveMessages() {
        localStorage.setItem('temerarius_messages', JSON.stringify(this.messages));
    }

    loadMessages() {
        const stored = localStorage.getItem('temerarius_messages');
        return stored ? JSON.parse(stored) : [];
    }

    saveUser(user) {
        const users = this.loadAllUsers().filter(u => u.id !== user.id);
        users.push(user);
        localStorage.setItem('temerarius_users', JSON.stringify(users));
    }

    loadAllUsers() {
        const stored = localStorage.getItem('temerarius_users');
        return stored ? JSON.parse(stored) : [];
    }

    saveTypingUsers() {
        localStorage.setItem('temerarius_typing', JSON.stringify(Array.from(this.typingUsers)));
    }

    loadTypingUsers() {
        const stored = localStorage.getItem('temerarius_typing');
        return new Set(stored ? JSON.parse(stored) : []);
    }

    saveSettings() {
        localStorage.setItem('temerarius_settings', JSON.stringify(this.settings));
    }

    loadSettings() {
        const stored = localStorage.getItem('temerarius_settings');
        return stored ? JSON.parse(stored) : {
            soundNotifications: true,
            theme: 'dark'
        };
    }

    clearChatHistory() {
        this.messages = [];
        this.saveMessages();
        console.log('Chat history cleared');
    }

    // Utility methods
    generateUserId() {
        return Date.now() + Math.random().toString(36).substr(2, 9);
    }

    generateMessageId() {
        return Date.now() + Math.random();
    }

    formatTime(timestamp) {
        return new Date(timestamp).toLocaleTimeString([], {
            hour: '2-digit',
            minute: '2-digit'
        });
    }

    formatRelativeTime(timestamp) {
        const now = Date.now();
        const diff = now - timestamp;
        
        if (diff < 60000) return 'just now';
        if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;
        if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;
        return `${Math.floor(diff / 86400000)}d ago`;
    }

    escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
}

// Initialize chat when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    window.temerariusChat = new TemerariusChat();
});
   </script>
   <script>
  class TemerariusUI {
    constructor() {
        this.messagesContainer = null;
        this.autoScroll = true;
        this.lastMessageCount = 0;
        
        this.init();
    }

    init() {
        this.messagesContainer = document.getElementById('messagesContainer');
        this.bindUIEvents();
        this.startUIUpdateLoop();
        console.log('Temerarius UI initialized');
    }

    bindUIEvents() {
        // Settings modal
        const settingsBtn = document.getElementById('settingsBtn');
        const settingsModal = document.getElementById('settingsModal');
        const closeSettings = document.getElementById('closeSettings');
        
        if (settingsBtn && settingsModal) {
            settingsBtn.addEventListener('click', () => {
                settingsModal.classList.remove('hidden');
                this.loadSettingsModal();
            });
        }
        
        if (closeSettings && settingsModal) {
            closeSettings.addEventListener('click', () => {
                settingsModal.classList.add('hidden');
            });
            
            settingsModal.addEventListener('click', (e) => {
                if (e.target === settingsModal) {
                    settingsModal.classList.add('hidden');
                }
            });
        }

        // Settings controls
        const newColorSelect = document.getElementById('newColorSelect');
        const soundToggle = document.getElementById('soundToggle');
        const clearChatBtn = document.getElementById('clearChatBtn');
        
        if (newColorSelect) {
            newColorSelect.addEventListener('change', (e) => {
                this.changeUserColor(e.target.value);
            });
        }
        
        if (soundToggle) {
            soundToggle.addEventListener('change', (e) => {
                this.toggleSound(e.target.checked);
            });
        }
        
        if (clearChatBtn) {
            clearChatBtn.addEventListener('click', () => {
                this.clearChat();
            });
        }

        // Emoji button (placeholder for future emoji picker)
        const emojiBtn = document.getElementById('emojiBtn');
        if (emojiBtn) {
            emojiBtn.addEventListener('click', () => {
                this.showEmojiTooltip();
            });
        }

        // Messages container scroll
        if (this.messagesContainer) {
            this.messagesContainer.addEventListener('scroll', () => {
                this.handleScroll();
            });
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            this.handleKeyboardShortcuts(e);
        });

        // Window resize
        window.addEventListener('resize', () => {
            this.handleResize();
        });
    }

    startUIUpdateLoop() {
        // Update UI every 100ms for smooth animations
        setInterval(() => {
            this.updateMessagesUI();
            this.updateActivityIndicators();
        }, 100);
    }

    updateMessagesUI() {
        if (!window.temerariusChat || !this.messagesContainer) return;
        
        const messages = window.temerariusChat.messages;
        
        // Only update if message count changed
        if (messages.length === this.lastMessageCount) return;
        
        this.renderMessages(messages);
        this.lastMessageCount = messages.length;
    }

    renderMessages(messages) {
        if (!this.messagesContainer) return;
        
        // Remove welcome message if it exists
        const welcomeMsg = this.messagesContainer.querySelector('.welcome-message');
        if (welcomeMsg && messages.length > 0) {
            welcomeMsg.remove();
        }
        
        // Get currently displayed messages
        const displayedMessages = Array.from(this.messagesContainer.querySelectorAll('.message, .system-message'))
            .map(el => el.dataset.messageId);
        
        // Find new messages to add
        const newMessages = messages.filter(msg => !displayedMessages.includes(msg.id.toString()));
        
        // Add new messages
        newMessages.forEach(message => {
            const messageEl = this.createMessageElement(message);
            this.messagesContainer.appendChild(messageEl);
        });
        
        // Auto-scroll if user is at bottom
        if (this.autoScroll && newMessages.length > 0) {
            this.scrollToBottom();
        }
        
        // Limit message history to prevent memory issues
        this.limitMessageHistory();
    }

    createMessageElement(message) {
        const messageEl = document.createElement('div');
        messageEl.dataset.messageId = message.id;
        
        if (message.type === 'system') {
            messageEl.className = 'system-message';
            messageEl.innerHTML = `
                <i class="fas fa-info-circle"></i>
                ${this.escapeHtml(message.text)}
            `;
        } else {
            const isOwn = window.temerariusChat.currentUser && 
                         message.userId === window.temerariusChat.currentUser.id;
            
            messageEl.className = `message ${isOwn ? 'own' : ''}`;
            messageEl.innerHTML = `
                <div class="message-avatar" style="background-color: ${message.color}">
                    ${message.username.charAt(0).toUpperCase()}
                </div>
                <div class="message-content">
                    <div class="message-header">
                        <span class="message-author" style="color: ${message.color}">
                            ${this.escapeHtml(message.username)}
                        </span>
                        <span class="message-time">
                            ${this.formatTime(message.timestamp)}
                        </span>
                    </div>
                    <div class="message-text">
                        ${this.formatMessageText(message.text)}
                    </div>
                </div>
            `;
        }
        
        return messageEl;
    }

    formatMessageText(text) {
        // Escape HTML
        let formatted = this.escapeHtml(text);
        
        // Convert URLs to links
        formatted = formatted.replace(
            /(https?:\/\/[^\s]+)/g, 
            '<a href="$1" target="_blank" rel="noopener noreferrer" style="color: var(--primary-color); text-decoration: underline;">$1</a>'
        );
        
        // Convert simple emojis
        const emojiMap = {
            ':)': 'üòä',
            ':D': 'üòÉ',
            ':(': 'üò¢',
            ':P': 'üòõ',
            ';)': 'üòâ',
            '<3': '‚ù§Ô∏è',
            '</3': 'üíî',
            ':heart:': '‚ù§Ô∏è',
            ':fire:': 'üî•',
            ':star:': '‚≠ê',
            ':thumbs_up:': 'üëç',
            ':thumbs_down:': 'üëé'
        };
        
        Object.entries(emojiMap).forEach(([key, emoji]) => {
            formatted = formatted.replace(new RegExp(this.escapeRegex(key), 'g'), emoji);
        });
        
        return formatted;
    }

    limitMessageHistory() {
        const messageElements = this.messagesContainer.querySelectorAll('.message, .system-message');
        const maxMessages = 500;
        
        if (messageElements.length > maxMessages) {
            const toRemove = messageElements.length - maxMessages;
            for (let i = 0; i < toRemove; i++) {
                messageElements[i].remove();
            }
        }
    }

    scrollToBottom() {
        if (this.messagesContainer) {
            this.messagesContainer.scrollTop = this.messagesContainer.scrollHeight;
        }
    }

    handleScroll() {
        if (!this.messagesContainer) return;
        
        const { scrollTop, scrollHeight, clientHeight } = this.messagesContainer;
        const isAtBottom = scrollTop + clientHeight >= scrollHeight - 10;
        
        this.autoScroll = isAtBottom;
    }

    updateActivityIndicators() {
        // Update user status indicators
        const userItems = document.querySelectorAll('.user-item');
        userItems.forEach(item => {
            const status = item.querySelector('.user-status');
            if (status) {
                const statusText = status.textContent.trim();
                status.className = `user-status status-${statusText}`;
                
                // Add status dots
                let dot = status.querySelector('.status-dot');
                if (!dot) {
                    dot = document.createElement('span');
                    dot.className = 'status-dot';
                    status.prepend(dot);
                }
                
                dot.style.backgroundColor = this.getStatusColor(statusText);
            }
        });
        
        // Update typing indicator animation
        const typingIndicator = document.getElementById('typingIndicator');
        if (typingIndicator && typingIndicator.textContent) {
            typingIndicator.classList.add('typing-animation');
        } else if (typingIndicator) {
            typingIndicator.classList.remove('typing-animation');
        }
    }

    getStatusColor(status) {
        switch (status) {
            case 'online': return 'var(--success-color)';
            case 'idle': return 'var(--warning-color)';
            case 'away': return 'var(--danger-color)';
            default: return 'var(--muted-text)';
        }
    }

    // Settings Modal Methods
    loadSettingsModal() {
        if (!window.temerariusChat) return;
        
        const settings = window.temerariusChat.settings;
        const currentUser = window.temerariusChat.currentUser;
        
        // Load current color
        const colorSelect = document.getElementById('newColorSelect');
        if (colorSelect && currentUser) {
            colorSelect.value = currentUser.color;
        }
        
        // Load sound setting
        const soundToggle = document.getElementById('soundToggle');
        if (soundToggle) {
            soundToggle.checked = settings.soundNotifications;
        }
    }

    changeUserColor(newColor) {
        if (!window.temerariusChat || !window.temerariusChat.currentUser) return;
        
        // Update user color
        window.temerariusChat.currentUser.color = newColor;
        window.temerariusChat.saveUser(window.temerariusChat.currentUser);
        
        // Update UI theme
        document.documentElement.style.setProperty('--primary-color', newColor);
        
        // Add system message
        window.temerariusChat.addSystemMessage(
            `${window.temerariusChat.currentUser.username} changed their color`
        );
        
        console.log('User color changed to:', newColor);
    }

    toggleSound(enabled) {
        if (!window.temerariusChat) return;
        
        window.temerariusChat.settings.soundNotifications = enabled;
        window.temerariusChat.saveSettings();
        
        console.log('Sound notifications:', enabled ? 'enabled' : 'disabled');
    }

    clearChat() {
        if (!window.temerariusChat) return;
        
        if (confirm('Are you sure you want to clear all chat history? This cannot be undone.')) {
            window.temerariusChat.clearChatHistory();
            
            // Clear UI
            if (this.messagesContainer) {
                this.messagesContainer.innerHTML = `
                    <div class="welcome-message">
                        <i class="fas fa-rocket"></i>
                        <h3>Welcome to Temerarius!</h3>
                        <p>Start chatting with people from around the world</p>
                    </div>
                `;
            }
            
            // Close modal
            const settingsModal = document.getElementById('settingsModal');
            if (settingsModal) {
                settingsModal.classList.add('hidden');
            }
            
            console.log('Chat history cleared');
        }
    }

    showEmojiTooltip() {
        const emojiBtn = document.getElementById('emojiBtn');
        if (!emojiBtn) return;
        
        // Create tooltip
        const tooltip = document.createElement('div');
        tooltip.className = 'emoji-tooltip';
        tooltip.innerHTML = `
            <div class="emoji-grid">
                <span class="emoji" data-emoji="üòä">üòä</span>
                <span class="emoji" data-emoji="üòÉ">üòÉ</span>
                <span class="emoji" data-emoji="üò¢">üò¢</span>
                <span class="emoji" data-emoji="üòõ">üòõ</span>
                <span class="emoji" data-emoji="üòâ">üòâ</span>
                <span class="emoji" data-emoji="‚ù§Ô∏è">‚ù§Ô∏è</span>
                <span class="emoji" data-emoji="üî•">üî•</span>
                <span class="emoji" data-emoji="‚≠ê">‚≠ê</span>
                <span class="emoji" data-emoji="üëç">üëç</span>
                <span class="emoji" data-emoji="üëé">üëé</span>
            </div>
        `;
        
        // Position tooltip
        const rect = emojiBtn.getBoundingClientRect();
        tooltip.style.position = 'absolute';
        tooltip.style.bottom = '60px';
        tooltip.style.left = '10px';
        tooltip.style.background = 'var(--dark-surface)';
        tooltip.style.border = '1px solid var(--border-color)';
        tooltip.style.borderRadius = '8px';
        tooltip.style.padding = '0.5rem';
        tooltip.style.boxShadow = 'var(--shadow-lg)';
        tooltip.style.zIndex = '1000';
        
        // Add tooltip to DOM
        emojiBtn.parentElement.appendChild(tooltip);
        
        // Handle emoji clicks
        tooltip.addEventListener('click', (e) => {
            if (e.target.classList.contains('emoji')) {
                const messageInput = document.getElementById('messageInput');
                if (messageInput) {
                    messageInput.value += e.target.dataset.emoji;
                    messageInput.focus();
                }
                tooltip.remove();
            }
        });
        
        // Remove tooltip when clicking outside
        setTimeout(() => {
            document.addEventListener('click', function removeTooltip(e) {
                if (!tooltip.contains(e.target) && e.target !== emojiBtn) {
                    tooltip.remove();
                    document.removeEventListener('click', removeTooltip);
                }
            });
        }, 100);
    }

    handleKeyboardShortcuts(e) {
        // Ctrl/Cmd + Enter to send message
        if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
            const messageForm = document.getElementById('messageForm');
            if (messageForm) {
                messageForm.dispatchEvent(new Event('submit'));
            }
        }
        
        // Escape to close modals
        if (e.key === 'Escape') {
            const modals = document.querySelectorAll('.modal:not(.hidden)');
            modals.forEach(modal => modal.classList.add('hidden'));
        }
        
        // Ctrl/Cmd + K to focus message input
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            const messageInput = document.getElementById('messageInput');
            if (messageInput) {
                messageInput.focus();
            }
        }
    }

    handleResize() {
        // Adjust layout for mobile
        const sidebar = document.querySelector('.sidebar');
        const chatContent = document.querySelector('.chat-content');
        
        if (window.innerWidth <= 768) {
            if (sidebar) sidebar.style.display = 'none';
            if (chatContent) chatContent.style.width = '100%';
        } else {
            if (sidebar) sidebar.style.display = '';
            if (chatContent) chatContent.style.width = '';
        }
    }

    // Utility methods
    formatTime(timestamp) {
        return new Date(timestamp).toLocaleTimeString([], {
            hour: '2-digit',
            minute: '2-digit'
        });
    }

    escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    escapeRegex(string) {
        return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }
}

// Add CSS for emoji tooltip and animations
const additionalStyles = `
    .emoji-tooltip {
        animation: fadeIn 0.2s ease;
    }
    
    .emoji-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 0.5rem;
    }
    
    .emoji {
        padding: 0.25rem;
        cursor: pointer;
        border-radius: 4px;
        transition: background-color 0.2s ease;
        text-align: center;
        font-size: 1.2rem;
    }
    
    .emoji:hover {
        background-color: var(--dark-surface-hover);
    }
    
    .typing-animation {
        animation: pulse 1.5s infinite;
    }
    
    .status-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 0.25rem;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
`;

// Inject additional styles
const styleSheet = document.createElement('style');
styleSheet.textContent = additionalStyles;
document.head.appendChild(styleSheet);

// Initialize UI when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    window.temerariusUI = new TemerariusUI();
});
   </script>
</body>
</html>